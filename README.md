### `Data pre-processing and analysis of the results obtained in Pix4Dfields`
This repository contains all preprocessing and evaluation code used in the study 
“Effects of Cane Density on Primocane Raspberry Assessed Us-ing UAV-Based Multispectral Imaging”.

## Citation
If you use this repository, please cite:
Will be added after publication

<p align="justify">Multispectral imaging enables the acquisition of extensive datasets that require advanced analytical processing. 
Pix4Dfields software allows the computation of vegetation indices for user-defined areas, along with their 
corresponding standard deviations, which are essential for further analyses. Nevertheless, although this process 
condenses raw imagery into interpretable metrics, it produces a substantial volume of results whose proper 
interpretation is critical, especially in long-term studies.</p>

<p align="justify">When analysing vegetation indices derived from Pix4Dfields across different time points, one possible approach 
involves their preliminary processing and, if necessary, the application of Exploratory Data Analysis (EDA). This step may be 
particularly useful when the results originate from different measurement and analysis methodologies, such as varying ground 
sampling distances (GSD) or annotation strategies, in order to identify the most stable outputs for subsequent interpretation. 
However, this procedure is not strictly required in all cases.</p>

<p align="center">
  <img src="results_analysis_scheme.png" alt="results_analysis_scheme.png" width="800"/>
</p>

<p align="justify">The schematic above illustrates the complete pipeline for the preliminary processing of the obtained results. 
  The workflow begins with the panel-based export of results for multiple layers derived from vegetation indices in Pix4Dfields, 
  together with the corresponding folder structure generated by the software. Consequently, the results of a single measurement 
  consist of vegetation index values calculated for all annotations present within the study area, saved as separate .csv files.</p>

<p align="justify">In the next step, these files are merged into a single .csv file using the DataMerge_FirstStep.py script when 
  the analysis is limited to a single measurement. Alternatively, the same script is applied independently to .csv files from 
  multiple measurement folders when the objective is to perform a temporal analysis.</p>

<p align="justify">The resulting .csv files from individual measurements are then merged into one comprehensive dataset. 
  Although this procedure could be implemented using a single script, the workflow was deliberately divided into two scripts 
  to provide greater flexibility. The DataMerge_SecondStep.py script performs the final merge and enables the inclusion of data, 
  such as the measurement identifier and flight altitude, in the output .csv file, which substantially facilitates subsequent analyses.</p>

<p align="justify">In addition, the DataCorrectness_Test.py script is used to verify the integrity of the final merged dataset with
  respect to potential missing values, while the Sorting_Results.py script allows the results to be organized into a more logical and 
  structured format.</p>

 # Temporal vegetation index metrics

Let

$$
\mathbf{y} = \{ y_1, y_2, \dots, y_N \}
$$

be a time series of **mean vegetation index values**, where:

- $y_i$ — mean vegetation index value at measurement $i$
- $N$ — total number of measurement dates

Temporal differences between consecutive measurements are defined as:

$$
\Delta_i = y_{i+1} - y_i \quad \text{for } i = 1, \dots, N-1
$$

Absolute differences:

$$
|\Delta_i| = |y_{i+1} - y_i|
$$

A small constant

$$
\varepsilon = 10^{-6}
$$

is used to avoid division by zero.

---

## 1. Mean vegetation index value (`Mean_index`)

$$
\bar{y} = \frac{1}{N} \sum_{i=1}^{N} y_i
$$

**Description:**  
Arithmetic mean of the vegetation index time series.

---

## 2. Temporal standard deviation (`SD_index`)

$$
SD_y = \sqrt{\frac{1}{N-1} \sum_{i=1}^{N} (y_i - \bar{y})^2}
$$

**Description:**  
Standard deviation of vegetation index values across time, describing absolute temporal variability.

---

## 3. Temporal coefficient of variation (`CV_index`)

$$
CV_y = \frac{SD_y}{\bar{y}}
$$

**Description:**  
Relative temporal variability of the vegetation index, expressed as the ratio between standard deviation and mean.

---

## 4. Total absolute temporal amplitude (`A_total`)

$$
A = \sum_{i=1}^{N-1} |\Delta_i|
$$

**Description:**  
Cumulative magnitude of absolute changes between consecutive measurements.

---

## 5. Total positive temporal change (`A_growth`)

$$
G = \sum_{i=1}^{N-1} \max(\Delta_i, 0)
$$

**Description:**  
Sum of all positive changes in the vegetation index time series.

---

## 6. Total negative temporal change (`A_drop`)

$$
D = \sum_{i=1}^{N-1} \max(-\Delta_i, 0)
$$

**Description:**  
Sum of absolute values of all negative changes in the vegetation index time series.

---

## 7. Total relative temporal amplitude (`A_pct_total`)

$$
A_{\%} = \sum_{i=1}^{N-1} \left| \frac{\Delta_i}{y_i + \varepsilon} \right|
$$

**Description:**  
Sum of absolute relative changes between consecutive measurements, normalised by the preceding value.

---

## 8. Total relative positive change (`A_pct_growth`)

$$
G_{\%} = \sum_{i=1}^{N-1} \max\!\left( \frac{\Delta_i}{y_i + \varepsilon}, 0 \right)
$$

**Description:**  
Cumulative relative magnitude of all positive temporal changes.

---

## 9. Total relative negative change (`A_pct_drop`)

$$
D_{\%} = \sum_{i=1}^{N-1} \max\!\left( \frac{-\Delta_i}{y_i + \varepsilon}, 0 \right)
$$

**Description:**  
Cumulative relative magnitude of all negative temporal changes.

---

## 10. Number of positive changes (`n_growth`)

$$
n_{+} = \sum_{i=1}^{N-1} \mathbf{1}(\Delta_i > 0)
$$

**Description:**  
Number of consecutive measurement intervals with a positive vegetation index change.

---

## 11. Number of negative changes (`n_drop`)

$$
n_{-} = \sum_{i=1}^{N-1} \mathbf{1}(\Delta_i < 0)
$$

**Description:**  
Number of consecutive measurement intervals with a negative vegetation index change.

---

## 12. Temporal roughness (`J_roughness`)

$$
J = \sum_{i=1}^{N-2} |\Delta_{i+1} - \Delta_i|
$$

**Description:**  
Sum of absolute second-order differences, quantifying irregularity in the rate of temporal change.

---

## 13. Concentration of temporal changes (`C_concentration`)

First, normalised absolute changes:

$$
p_i = \frac{|\Delta_i|}{A}
$$

Then:

$$
C = \sum_{i=1}^{N-1} p_i^2
$$

**Description:**  
Measure of how temporal changes are distributed across time; higher values indicate that changes are concentrated in fewer intervals.

---

## 14. Normalised total temporal amplitude (`A_u_margin`)

For each interval:

$$
u_i =
\begin{cases}
\dfrac{\Delta_i}{1 - y_i + \varepsilon}, & \text{if } \Delta_i > 0 \\
\dfrac{-\Delta_i}{y_i + \varepsilon}, & \text{if } \Delta_i < 0
\end{cases}
$$

Then:

$$
A_u = \sum_{i=1}^{N-1} u_i
$$

**Description:**  
Total temporal change normalised relative to the available vegetation index range $[0,1]$.

---

## 15. Normalised temporal roughness (`J_u_margin`)

$$
J_u = \sum_{i=1}^{N-2} |u_{i+1} - u_i|
$$

**Description:**  
Irregularity of temporal dynamics after normalisation to index bounds.

---

## 16. Level–motion correlation (`K_level_motion`)

Define:

$$
m_i = \frac{y_i + y_{i+1}}{2}, \quad a_i = |\Delta_i|
$$

Then:

$$
K = \rho_{\text{Spearman}}(m_i, a_i)
$$

**Description:**  
Spearman rank correlation between local vegetation index level and magnitude of temporal change, indicating whether larger changes occur at higher or lower index values.

