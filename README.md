### `Data pre-processing and analysis of the results obtained in Pix4Dfields`
This repository contains all preprocessing and evaluation code used in the study 
“Effects of Cane Density on Primocane Raspberry Assessed Us-ing UAV-Based Multispectral Imaging”.

## Citation
If you use this repository, please cite:
Will be added after publication

<p align="justify">Multispectral imaging enables the acquisition of extensive datasets that require advanced analytical processing. 
Pix4Dfields software allows the computation of vegetation indices for user-defined areas, along with their 
corresponding standard deviations, which are essential for further analyses. Nevertheless, although this process 
condenses raw imagery into interpretable metrics, it produces a substantial volume of results whose proper 
interpretation is critical, especially in long-term studies.</p>

<p align="justify">When analysing vegetation indices derived from Pix4Dfields across different time points, one possible approach 
involves their preliminary processing and, if necessary, the application of Exploratory Data Analysis (EDA). This step may be 
particularly useful when the results originate from different measurement and analysis methodologies, such as varying ground 
sampling distances (GSD) or annotation strategies, in order to identify the most stable outputs for subsequent interpretation. 
However, this procedure is not strictly required in all cases.</p>

<p align="center">
  <img src="results_analysis_scheme.png" alt="results_analysis_scheme.png" width="800"/>
</p>

<p align="justify">The schematic above illustrates the complete pipeline for the preliminary processing of the obtained results. 
  The workflow begins with the panel-based export of results for multiple layers derived from vegetation indices in Pix4Dfields, 
  together with the corresponding folder structure generated by the software. Consequently, the results of a single measurement 
  consist of vegetation index values calculated for all annotations present within the study area, saved as separate .csv files.</p>

<p align="justify">In the next step, these files are merged into a single .csv file using the DataMerge_FirstStep.py script when 
  the analysis is limited to a single measurement. Alternatively, the same script is applied independently to .csv files from 
  multiple measurement folders when the objective is to perform a temporal analysis.</p>

<p align="justify">The resulting .csv files from individual measurements are then merged into one comprehensive dataset. 
  Although this procedure could be implemented using a single script, the workflow was deliberately divided into two scripts 
  to provide greater flexibility. The DataMerge_SecondStep.py script performs the final merge and enables the inclusion of data, 
  such as the measurement identifier and flight altitude, in the output .csv file, which substantially facilitates subsequent analyses.</p>

<p align="justify">In addition, the DataCorrectness_Test.py script is used to verify the integrity of the final merged dataset with
  respect to potential missing values, while the Sorting_Results.py script allows the results to be organized into a more logical and 
  structured format.</p>

  ## Temporal metrics derived from vegetation index time series

Let

y = {y₁, y₂, …, y_N}

be the time series of mean vegetation index values, where  
yᵢ is the mean vegetation index value at measurement i, and  
N is the total number of measurement dates.

Temporal differences are defined as:

Δᵢ = yᵢ₊₁ − yᵢ,   for i = 1, …, N − 1

Absolute differences:

|Δᵢ| = |yᵢ₊₁ − yᵢ|

A small constant ε = 1e−6 is used to avoid division by zero.

---

### 1. Mean vegetation index value (Mean_index)

Mean_index = (1 / N) · Σᵢ₌₁ᴺ yᵢ

**Description:**  
Arithmetic mean of the vegetation index time series.

---

### 2. Temporal standard deviation (SD_index)

SD_index = sqrt( (1 / (N − 1)) · Σᵢ₌₁ᴺ (yᵢ − Mean_index)² )

**Description:**  
Absolute temporal variability of the vegetation index time series.

---

### 3. Temporal coefficient of variation (CV_index)

CV_index = SD_index / Mean_index

**Description:**  
Relative temporal variability expressed as the ratio of standard deviation to mean.

---

### 4. Total absolute temporal amplitude (A_total)

A_total = Σᵢ₌₁ᴺ⁻¹ |Δᵢ|

**Description:**  
Cumulative magnitude of absolute changes between consecutive measurements.

---

### 5. Total positive temporal change (A_growth)

A_growth = Σᵢ₌₁ᴺ⁻¹ max(Δᵢ, 0)

**Description:**  
Cumulative magnitude of all positive temporal changes.

---

### 6. Total negative temporal change (A_drop)

A_drop = Σᵢ₌₁ᴺ⁻¹ max(−Δᵢ, 0)

**Description:**  
Cumulative magnitude of all negative temporal changes.

---

### 7. Total relative temporal amplitude (A_pct_total)

A_pct_total = Σᵢ₌₁ᴺ⁻¹ |Δᵢ / (yᵢ + ε)|

**Description:**  
Sum of absolute relative changes between consecutive measurements.

---

### 8. Total relative positive change (A_pct_growth)

A_pct_growth = Σᵢ₌₁ᴺ⁻¹ max(Δᵢ / (yᵢ + ε), 0)

**Description:**  
Cumulative relative magnitude of all positive changes.

---

### 9. Total relative negative change (A_pct_drop)

A_pct_drop = Σᵢ₌₁ᴺ⁻¹ max(−Δᵢ / (yᵢ + ε), 0)

**Description:**  
Cumulative relative magnitude of all negative changes.

---

### 10. Number of positive changes (n_growth)

n_growth = Σᵢ₌₁ᴺ⁻¹ I(Δᵢ > 0)

**Description:**  
Number of intervals with a positive temporal change.

---

### 11. Number of negative changes (n_drop)

n_drop = Σᵢ₌₁ᴺ⁻¹ I(Δᵢ < 0)

**Description:**  
Number of intervals with a negative temporal change.

---

### 12. Temporal roughness (J_roughness)

J_roughness = Σᵢ₌₁ᴺ⁻² |Δᵢ₊₁ − Δᵢ|

**Description:**  
Second-order temporal variability describing irregularity in change rates.

---

### 13. Concentration of temporal changes (C_concentration)

First, normalized absolute changes:

pᵢ = |Δᵢ| / A_total

Then:

C_concentration = Σᵢ₌₁ᴺ⁻¹ pᵢ²

**Description:**  
Measure of how temporal changes are concentrated across intervals; higher values indicate that changes are dominated by fewer intervals.

---

### 14. Normalized total temporal amplitude (A_u_margin)

For each interval:

uᵢ =
- Δᵢ / (1 − yᵢ + ε), if Δᵢ > 0  
- (−Δᵢ) / (yᵢ + ε), if Δᵢ < 0

Then:

A_u_margin = Σᵢ₌₁ᴺ⁻¹ uᵢ

**Description:**  
Total temporal change normalized relative to the available index range [0, 1].

---

### 15. Normalized temporal roughness (J_u_margin)

J_u_margin = Σᵢ₌₁ᴺ⁻² |uᵢ₊₁ − uᵢ|

**Description:**  
Irregularity of normalized temporal changes accounting for proximity to index bounds.

---

### 16. Level–motion correlation (K_level_motion)

Define:

mᵢ = (yᵢ + yᵢ₊₁) / 2  
aᵢ = |Δᵢ|

Then:

K_level_motion = SpearmanCorr(mᵢ, aᵢ)

**Description:**  
Spearman rank correlation between local index level and magnitude of temporal change, indicating whether stronger changes occur at higher or lower index values.

